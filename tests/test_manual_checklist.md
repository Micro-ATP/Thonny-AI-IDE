# AI Completion Plugin - 手动测试清单

## 测试环境准备

- [ ] Thonny IDE 已安装（版本 4.x）
- [ ] AI Completion 插件已安装到 `thonnycontrib/ai_completion/`
- [ ] API 配置已完成（API Key、Endpoint、Model）

---

## 一、基础功能测试

### 1.1 插件加载测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 插件启动 | 启动 Thonny | 无错误提示，Tools 菜单显示 "AI Code Completion" | | [ ] |
| 设置菜单 | Tools → AI Assistant Settings | 设置对话框正常打开 | | [ ] |
| 快捷键显示 | 查看 Tools 菜单 | 显示 Ctrl+Alt+A 快捷键 | | [ ] |

### 1.2 手动触发补全测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 基础补全 | 输入 `def hello` 后按 Ctrl+Alt+A | 显示灰色 Ghost Text 建议 | | [ ] |
| Tab 接受 | 显示建议后按 Tab | 建议被接受，变为正常文本 | | [ ] |
| Esc 取消 | 显示建议后按 Esc | 建议消失，代码不变 | | [ ] |
| 状态栏提示 | 触发补全 | 状态栏显示 "🤖 AI is thinking..." | | [ ] |

---

## 二、核心 Bug 修复验证

### 2.1 光标在代码中间位置测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 中间位置补全 | 在已有代码中间位置（如函数体内）触发补全 | 建议插入到光标位置，不覆盖后续代码 | | [ ] |
| 接受中间补全 | 接受中间位置的补全 | 光标移到补全末尾，后续代码保持不变 | | [ ] |
| 取消中间补全 | 取消中间位置的补全 | 代码恢复原状 | | [ ] |

**测试代码示例：**
```python
def calculate():
    x = 10
    # 将光标放在这里，触发补全
    return x * 2
```

### 2.2 快捷键多次按压测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 请求中重复按键 | 触发补全后立即再按 Ctrl+Alt+A | 忽略重复按键，等待第一次请求完成 | | [ ] |
| 显示中重复按键 | 建议显示后再按 Ctrl+Alt+A | 刷新建议（清除旧的，请求新的） | | [ ] |
| 快速连按 5 次 | 快速连续按 5 次 Ctrl+Alt+A | 行为稳定，无异常 | | [ ] |

### 2.3 代码重叠检测测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 与后续代码重叠 | 在已有代码前触发补全 | 建议不包含已存在的后续代码 | | [ ] |
| 与前置代码重叠 | 触发补全 | 建议不重复光标前已有的代码 | | [ ] |
| 大文件补全 | 在 500+ 行的文件中触发补全 | 无代码重复 | | [ ] |

**测试代码示例：**
```python
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# 在这里输入 "fibon" 然后触发补全
# 应该补全为函数调用，而不是重复定义函数
```

### 2.4 API 错误提示测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 无 API Key | 清空 API Key 后触发补全 | 弹出错误对话框，提示配置 API | | [ ] |
| 无效 API Key | 设置错误的 API Key 后触发补全 | 显示 "API 密钥无效" 错误 | | [ ] |
| 错误 Endpoint | 设置错误的 Endpoint 后触发补全 | 显示 "端点连接失败" 错误 | | [ ] |
| 引导设置 | 出现 API 错误时 | 询问是否打开设置页面 | | [ ] |

---

## 三、边缘案例测试

### 3.1 空文件测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 空文件补全 | 在空文件中触发补全 | 正常工作或显示 "No suggestion" | | [ ] |
| 只有空格 | 文件只包含空格/换行时触发补全 | 正常处理 | | [ ] |

### 3.2 大文件测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 1000 行文件 | 在 1000 行的文件中触发补全 | 响应时间合理（<30s） | | [ ] |
| 上下文截断 | 在大文件中触发补全 | 只传递合理大小的上下文 | | [ ] |

### 3.3 多编辑器测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 多标签页 | 打开多个文件，在不同标签页触发补全 | 每个编辑器独立工作 | | [ ] |
| 切换标签 | 显示建议时切换标签页 | 建议正确清除 | | [ ] |

### 3.4 特殊输入测试
| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 中文注释 | 在中文注释后触发补全 | 正常工作 | | [ ] |
| Unicode | 代码包含 Unicode 字符时触发补全 | 正常工作 | | [ ] |
| 多行字符串 | 在多行字符串内触发补全 | 正常工作或合理处理 | | [ ] |

---

## 四、Ask AI Everything 测试

| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 打开对话框 | 按 Ctrl+Alt+Q 或 Tools → Ask AI Everything | 对话框正常打开 | | [ ] |
| 发送消息 | 输入问题并回车 | 显示 AI 回复 | | [ ] |
| 对话历史 | 连续发送多条消息 | 上下文保持连贯 | | [ ] |
| 清空对话 | 点击清空按钮 | 对话历史被清除 | | [ ] |
| TTS 功能 | 点击朗读按钮（如果可用） | 朗读 AI 回复 | | [ ] |

---

## 五、设置功能测试

| 测试项 | 步骤 | 预期结果 | 实际结果 | 通过 |
|--------|------|----------|----------|------|
| 打开设置 | Ctrl+Shift+A | 设置对话框打开 | | [ ] |
| 保存配置 | 修改设置并保存 | 配置被持久化 | | [ ] |
| 测试连接 | 点击 "Test Connection" | 显示连接结果 | | [ ] |
| 重启生效 | 修改配置后重启 Thonny | 配置保持有效 | | [ ] |

---

## 测试结果汇总

**测试日期：** ________________

**测试人员：** ________________

**Thonny 版本：** ________________

**插件版本：** 2.0.0-copilot

| 类别 | 总测试数 | 通过 | 失败 | 跳过 |
|------|----------|------|------|------|
| 基础功能 | 4 | | | |
| Bug 修复验证 | 12 | | | |
| 边缘案例 | 10 | | | |
| Ask AI | 5 | | | |
| 设置功能 | 4 | | | |
| **总计** | **35** | | | |

---

## 已知问题记录

| 问题描述 | 复现步骤 | 严重程度 | 状态 |
|----------|----------|----------|------|
| | | | |
| | | | |

---

## 备注

- 测试时请确保网络连接正常
- API 配置请使用有效的 API Key
- 如遇问题，请查看 Thonny 的后端日志

